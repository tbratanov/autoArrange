!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).workspaces=e.workspaces||{},e.workspaces.min=t())}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function e(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{d(i.next(e))}catch(e){n(e)}}function a(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}d((i=i.apply(e,t||[])).next())}))}function t(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,r={};function i(r,i){var o=r instanceof Error?r:new Error(r);if(t)t(o);else{var n='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+o.stack;if(e)switch(e.errorHandling){case"log":return console.error(n);case"silent":return;case"throw":throw new Error(n)}console.error(n)}}return{add:function(e,t){var i=r[e];return i||(i=[],r[e]=i),i.push(t),function(){var i=r[e];i&&(i=i.reduce((function(e,r,i){return r===t&&e.length===i||e.push(r),e}),[]),r[e]=i)}},execute:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var n=r[e];if(!n||0===n.length)return[];var s=[];return n.forEach((function(r){try{var o=r.apply(void 0,t);s.push(o)}catch(t){s.push(void 0),i(t,e)}})),s},clear:function(){r={}},clearKey:function(e){r[e]&&delete r[e]}}}t.default=t;var r=t,i=function(e){return{ok:!0,result:e}},o=function(e){return{ok:!1,error:e}},n=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},s=function(e,t){return!0===t.ok?t.result:e},a=function(e){if(!0===e.ok)return e.result;throw e.error},d=function(e,t){return!0===t.ok?i(e(t.result)):t},c=function(e,t,r){return!1===t.ok?t:!1===r.ok?r:i(e(t.result,r.result))},h=function(e,t){return!0===t.ok?t:o(e(t.error))},l=function(e,t){return!0===t.ok?e(t.result):t},u=(Object.freeze({ok:i,isOk:function(e){return!0===e.ok},err:o,isErr:function(e){return!1===e.ok},asPromise:n,withDefault:s,withException:a,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:d,map2:c,mapError:h,andThen:l}),function(){return(u=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)});var p=function(e){return Array.isArray(e)},m=function(e){return"object"==typeof e&&null!==e&&!p(e)},f=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},g=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},w=function(e,t){var r=t.at,i=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(r[i[o]]=e[i[o]])}return r}(t,["at"]);return u({at:e+(r||"")},i)},y=function(){function e(t){var r=this;this.decode=t,this.run=function(e){return h((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),r.decode(e))},this.runPromise=function(e){return n(r.run(e))},this.runWithException=function(e){return a(r.run(e))},this.map=function(t){return new e((function(e){return d(t,r.decode(e))}))},this.andThen=function(t){return new e((function(e){return l((function(r){return t(r).decode(e)}),r.decode(e))}))},this.where=function(t,i){return r.andThen((function(r){return t(r)?e.succeed(r):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?i(e):o({message:f("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?i(e):o({message:f("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?i(e):o({message:f("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return function e(t,r){if(t===r)return!0;if(null===t&&null===r)return!0;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}var o=Object.keys(t);if(o.length!==Object.keys(r).length)return!1;for(i=0;i<o.length;i++){if(!r.hasOwnProperty(o[i]))return!1;if(!e(t[o[i]],r[o[i]]))return!1}return!0}}(e,t)?i(t):o({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(m(e)&&t){var r={};for(var n in t)if(t.hasOwnProperty(n)){var s=t[n].decode(e[n]);if(!0!==s.ok)return void 0===e[n]?o({message:"the key '"+n+"' is required but was not present"}):o(w("."+n,s.error));void 0!==s.result&&(r[n]=s.result)}return i(r)}return m(e)?i(e):o({message:f("an object",e)})}))},e.array=function(t){return new e((function(e){if(p(e)&&t){return e.reduce((function(e,r,i){return c((function(e,t){return e.concat([t])}),e,function(e,r){return h((function(e){return w("["+r+"]",e)}),t.decode(e))}(r,i))}),i([]))}return p(e)?i(e):o({message:f("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(p(e)){if(e.length!==t.length)return o({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var r=[],n=0;n<t.length;n++){var s=t[n].decode(e[n]);if(!s.ok)return o(w("["+n+"]",s.error));r[n]=s.result}return i(r)}return o({message:f("a tuple of length "+t.length,e)})}))},e.union=function(t,r){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.oneOf.apply(e,[t,r].concat(i))},e.intersection=function(t,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];return new e((function(e){return[t,r].concat(o).reduce((function(t,r){return c(Object.assign,t,r.decode(e))}),i({}))}))},e.anyJson=function(){return new e((function(e){return i(e)}))},e.unknownJson=function(){return new e((function(e){return i(e)}))},e.dict=function(t){return new e((function(e){if(m(e)){var r={};for(var n in e)if(e.hasOwnProperty(n)){var s=t.decode(e[n]);if(!0!==s.ok)return o(w("."+n,s.error));r[n]=s.result}return i(r)}return o({message:f("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?i(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new e((function(e){for(var r=[],i=0;i<t.length;i++){var n=t[i].decode(e);if(!0===n.ok)return n;r[i]=n.error}var s=r.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return o({message:'expected a value matching one of the decoders, got the errors ["'+s+'"]'})}))},e.withDefault=function(t,r){return new e((function(e){return i(s(t,r.decode(e)))}))},e.valueAt=function(t,r){return new e((function(e){for(var i=e,n=0;n<t.length;n++){if(void 0===i)return o({at:g(t.slice(0,n+1)),message:"path does not exist"});if("string"==typeof t[n]&&!m(i))return o({at:g(t.slice(0,n+1)),message:f("an object",i)});if("number"==typeof t[n]&&!p(i))return o({at:g(t.slice(0,n+1)),message:f("an array",i)});i=i[t[n]]}return h((function(e){return void 0===i?{at:g(t),message:"path does not exist"}:w(g(t),e)}),r.decode(i))}))},e.succeed=function(t){return new e((function(e){return i(t)}))},e.fail=function(t){return new e((function(e){return o({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),v=y.string,k=y.number,W=y.boolean,b=y.anyJson,I=y.constant,x=y.object,D=y.array,S=y.optional,C=y.oneOf,E=y.intersection,B=y.lazy;const M=v().where(e=>e.length>0,"Expected a non-empty string"),P=k().where(e=>e>=0,"Expected a non-negative number"),A=k().where(e=>e>0,"Expected a positive number"),F=x({inWorkspace:W()}),T=C(I("workspace"),I("row"),I("column"),I("group")),R=C(I("row"),I("column"),I("group")),L=C(I("maximized"),I("minimized"),I("normal")),z=(e,t)=>{const r=typeof e;if(t&&"function"!==r&&"undefined"!==r)throw new Error("Provided argument must be either undefined or of type function, provided: "+r);if(!t&&"function"!==r)throw new Error("Provided argument must be of type function, provided: "+r)},H=S(x({saveLayout:S(W())})),O=x({name:M}),j=x({minWidth:S(k()),maxWidth:S(k()),minHeight:S(k()),maxHeight:S(k()),allowExtract:S(W()),showCloseButton:S(W())}),_=x({minWidth:S(k()),maxWidth:S(k()),minHeight:S(k()),maxHeight:S(k()),allowExtract:S(W()),allowDrop:S(W()),allowDropHeader:S(W()),allowDropLeft:S(W()),allowDropRight:S(W()),allowDropTop:S(W()),allowDropBottom:S(W()),showMaximizeButton:S(W()),showEjectButton:S(W()),showAddWindowButton:S(W())}),$=x({minHeight:S(k()),maxHeight:S(k()),allowDrop:S(W()),allowSplitters:S(W()),isPinned:S(W())}),G=x({minWidth:S(k()),maxWidth:S(k()),allowDrop:S(W()),allowSplitters:S(W()),isPinned:S(W())}),N=x({type:S(I("window")),appName:S(M),windowId:S(M),context:S(b()),config:S(j)}),J=x({type:I("window"),appName:S(M),windowId:S(M),context:S(b()),config:S(j)}),U=S(x({type:S(R),children:S(B(()=>D(C(N,U)))),config:S(b())})),K=x({type:I("column"),children:S(B(()=>D(C(J,V)))),config:S(G)}),q=x({type:I("row"),children:S(B(()=>D(C(J,V)))),config:S($)}),Q=x({type:I("group"),children:S(B(()=>D(C(J,V)))),config:S(_)}),V=C(Q,K,q),X=(C(v().where(e=>"maximized"===e.toLowerCase(),"Expected a case insensitive variation of 'maximized'"),v().where(e=>"normal"===e.toLowerCase(),"Expected a case insensitive variation of 'normal'")),x({bounds:S(x({left:S(k()),top:S(k()),width:S(P),height:S(P)}))})),Y=C(I("direct"),I("delayed"),I("lazy")),Z=S(x({app:S(M),context:S(b()),loadingStrategy:S(Y),title:S(M),reuseWorkspaceId:S(M),frameId:S(M),lockdown:S(W()),activateFrame:S(W()),newFrame:S(C(X,W())),noTabHeader:S(W()),inMemoryLayout:S(W()),icon:S(M),isPinned:S(W()),isSelected:S(W()),positionIndex:S(P)})),ee=x({name:M,restoreOptions:S(Z)}),te=x({children:S(D(C(N,U))),context:S(b()),config:S(x({title:S(M),position:S(P),isFocused:S(W()),noTabHeader:S(W()),reuseWorkspaceId:S(M),loadingStrategy:S(Y),allowDrop:S(W()),allowDropLeft:S(W()),allowDropTop:S(W()),allowDropRight:S(W()),allowDropBottom:S(W()),allowExtract:S(W()),showSaveButton:S(W()),showCloseButton:S(W()),allowSplitters:S(W()),showWindowCloseButtons:S(W()),showEjectButtons:S(W()),showAddWindowButtons:S(W()),icon:S(M),isPinned:S(W()),isSelected:S(W()),positionIndex:S(P)})),frame:S(x({reuseFrameId:S(M),newFrame:S(C(W(),X))}))}),re=x({workspaceId:M}),ie=x({name:M,restoreOptions:S(Z)}),oe=S(x({frameConfig:S(X),context:S(x())})),ne=x({workspaces:D(C(S(te),S(ie)))}),se=x({frameId:M,workspaces:D(C(te,ie))}),ae=x({type:T,definition:S(C(te,U))}),de=E(te,x({saveConfig:S(x({saveLayout:S(W())}))})),ce=x({itemId:M}),he=x({context:S(x())}),le=x({id:M,isInitialized:S(W()),initializationContext:S(he)}),ue=(x({type:R,id:M,frameId:M,workspaceId:M,positionIndex:k()}),C(I("frame"),I("workspace"),I("container"),I("window"))),pe=x({type:ue,branch:M}),me=C(I("opened"),I("closing"),I("closed"),I("focus"),I("added"),I("loaded"),I("removed"),I("childrenUpdate"),I("containerChange"),I("maximized"),I("minimized"),I("normal"),I("selected")),fe=x({frameId:M,title:M,positionIndex:P,name:M,layoutName:S(M),isHibernated:S(W()),isSelected:S(W()),allowDrop:S(W()),allowExtract:S(W()),allowSplitters:S(W()),showCloseButton:S(W()),showSaveButton:S(W()),allowDropLeft:S(W()),allowDropTop:S(W()),allowDropRight:S(W()),allowDropBottom:S(W()),minWidth:S(k()),maxWidth:S(k()),minHeight:S(k()),maxHeight:S(k()),showAddWindowButtons:S(W()),showEjectButtons:S(W()),showWindowCloseButtons:S(W()),widthInPx:S(k()),heightInPx:S(k()),isPinned:S(W())}),ge=x({frameId:M,workspaceId:M,positionIndex:k(),minWidth:S(k()),maxWidth:S(k()),minHeight:S(k()),maxHeight:S(k())}),we=b(),ye=E(ge,x({windowId:S(M),isMaximized:S(W()),isFocused:W(),title:S(v()),appName:S(M),allowExtract:S(W()),showCloseButton:S(W()),minWidth:S(k()),minHeigth:S(k()),maxWidth:S(k()),maxHeight:S(k()),widthInPx:S(k()),heightInPx:S(k())})),ve=x({id:S(M),config:we,children:S(B(()=>D(We))),type:C(I("row"),I("column"),I("group"))}),ke=x({id:S(M),config:ye,type:I("window")}),We=C(ke,ve),be=x({id:M,config:fe,children:D(We),frameSummary:le}),Ie=x({type:I("window"),config:x({appName:M,url:S(M),title:S(v()),allowExtract:S(W()),showCloseButton:S(W()),minWidth:S(k()),minHeigth:S(k()),maxWidth:S(k()),maxHeight:S(k()),isMaximized:S(W())})}),xe=x({type:I("group"),config:b(),children:D(C(Ie))}),De=x({type:I("column"),config:b(),children:D(C(xe,Ie,B(()=>De),B(()=>Se)))}),Se=x({type:I("row"),config:b(),children:D(C(De,xe,Ie,B(()=>Se)))}),Ce=x({name:M,type:I("Workspace"),metadata:S(b()),components:D(x({type:I("Workspace"),state:x({config:b(),context:b(),children:D(C(Se,De,xe,Ie))})}))}),Ee=x({layout:Ce,mode:C(I("replace"),I("merge"))}),Be=x({layouts:D(Ce)}),Me=x({id:M,isInitialized:S(W()),initializationContext:S(he)}),Pe=x({summaries:D(Me)}),Ae=x({id:M,config:fe}),Fe=x({summaries:D(Ae)}),Te=x({id:M,config:b(),workspaces:D(be)}),Re=x({name:M}),Le=x({summaries:D(Re)}),ze=x({windowId:M}),He=b(),Oe=x({state:L}),je=x({bounds:x({top:k(),left:k(),width:P,height:P})}),_e=x({icon:S(M)}),$e=x({width:S(A),height:S(A),relative:S(W())}),Ge=x({top:S(k()),left:S(k()),relative:S(W())}),Ne=x({itemId:M}),Je=x({frameId:M,requestedState:L}),Ue=x({itemId:M,title:M}),Ke=x({itemId:M,containerId:M}),qe=E(Ne,$e),Qe=E(Ne,Ge),Ve=(x({id:M,type:R}),x({definition:N,parentId:M,parentType:T})),Xe=x({definition:V,parentId:M,parentType:T}),Ye=x({itemId:M,windowId:S(M)}),Ze=x({live:W()}),et=x({type:C(I("row"),I("column")),workspaceId:M}),tt=x({itemId:M,config:we}),rt=x({frameSummary:le}),it=x({workspaceSummary:Ae,frameSummary:le,workspaceSnapshot:S(be)}),ot=x({containerSummary:tt}),nt=x({windowSummary:x({itemId:M,parentId:M,config:ye})}),st=x({name:M,workspaceId:M,saveContext:S(W()),metadata:S(x())}),at=x({allowDrop:S(W()),allowDropLeft:S(W()),allowDropTop:S(W()),allowDropRight:S(W()),allowDropBottom:S(W()),allowExtract:S(W()),allowSplitters:S(W()),showCloseButton:S(W()),showSaveButton:S(W()),showWindowCloseButtons:S(W()),showAddWindowButtons:S(W()),showEjectButtons:S(W())}),dt=x({workspaceId:M,config:S(at)}),ct=x({allowExtract:S(W()),showCloseButton:S(W())}),ht=x({width:S(P),height:S(P)}),lt=x({windowPlacementId:M,config:S(ct)}),ut=x({allowDrop:S(W()),allowSplitters:S(W())}),pt=x({allowDrop:S(W()),allowSplitters:S(W())}),mt=x({allowExtract:S(W()),allowDrop:S(W()),allowDropLeft:S(W()),allowDropRight:S(W()),allowDropTop:S(W()),allowDropBottom:S(W()),allowDropHeader:S(W()),showMaximizeButton:S(W()),showEjectButton:S(W()),showAddWindowButton:S(W())}),ft=x({itemId:M,type:I("row"),config:S(ut)}),gt=x({itemId:M,type:I("column"),config:S(pt)}),wt=x({itemId:M,type:I("group"),config:S(mt)}),yt=C(ft,gt,wt),vt=x({workspaceId:M,icon:S(M)}),kt=x({workspaceId:M,icon:S(M)}),Wt=S(x({icon:S(M)})),bt="T42.Web.Platform.Control",It="T42.Web.Platform.WSP.Stream",xt={control:{name:"T42.Workspaces.Control",isStream:!1},frameStream:{name:"T42.Workspaces.Stream.Frame",isStream:!0},workspaceStream:{name:"T42.Workspaces.Stream.Workspace",isStream:!0},containerStream:{name:"T42.Workspaces.Stream.Container",isStream:!0},windowStream:{name:"T42.Workspaces.Stream.Window",isStream:!0}},Dt={frame:{name:"T42.Workspaces.Stream.Frame",payloadDecoder:rt},workspace:{name:"T42.Workspaces.Stream.Workspace",payloadDecoder:it},container:{name:"T42.Workspaces.Stream.Container",payloadDecoder:ot},window:{name:"T42.Workspaces.Stream.Window",payloadDecoder:nt}},St={ping:{name:"ping",resultDecoder:Ze},isWindowInWorkspace:{name:"isWindowInWorkspace",argsDecoder:Ne,resultDecoder:F},createWorkspace:{name:"createWorkspace",resultDecoder:be,argsDecoder:de},createFrame:{name:"createFrame",resultDecoder:Me,argsDecoder:oe},initFrame:{name:"initFrame",resultDecoder:He,argsDecoder:se},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:Pe},getFrameSummary:{name:"getFrameSummary",resultDecoder:le,argsDecoder:ce},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:Fe},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",resultDecoder:be,argsDecoder:Ne},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:Le},openWorkspace:{name:"openWorkspace",argsDecoder:ee,resultDecoder:be},deleteLayout:{name:"deleteLayout",resultDecoder:He,argsDecoder:O},saveLayout:{name:"saveLayout",resultDecoder:Ce,argsDecoder:st},importLayout:{name:"importLayout",resultDecoder:He,argsDecoder:Ee},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:Be},restoreItem:{name:"restoreItem",argsDecoder:Ne,resultDecoder:He},maximizeItem:{name:"maximizeItem",argsDecoder:Ne,resultDecoder:He},focusItem:{name:"focusItem",argsDecoder:Ne,resultDecoder:He},closeItem:{name:"closeItem",argsDecoder:Ne,resultDecoder:He},resizeItem:{name:"resizeItem",argsDecoder:qe,resultDecoder:He},changeFrameState:{name:"changeFrameState",argsDecoder:Je,resultDecoder:He},getFrameState:{name:"getFrameState",argsDecoder:Ne,resultDecoder:Oe},getFrameBounds:{name:"getFrameBounds",argsDecoder:Ne,resultDecoder:je},moveFrame:{name:"moveFrame",argsDecoder:Qe,resultDecoder:He},getFrameSnapshot:{name:"getFrameSnapshot",argsDecoder:Ne,resultDecoder:Te},forceLoadWindow:{name:"forceLoadWindow",argsDecoder:Ne,resultDecoder:ze},ejectWindow:{name:"ejectWindow",argsDecoder:Ne,resultDecoder:ze},setItemTitle:{name:"setItemTitle",argsDecoder:Ue,resultDecoder:He},moveWindowTo:{name:"moveWindowTo",argsDecoder:Ke,resultDecoder:He},addWindow:{name:"addWindow",argsDecoder:Ve,resultDecoder:Ye},addContainer:{name:"addContainer",argsDecoder:Xe,resultDecoder:Ye},bundleWorkspace:{name:"bundleWorkspace",argsDecoder:et,resultDecoder:He},hibernateWorkspace:{name:"hibernateWorkspace",argsDecoder:re,resultDecoder:He},resumeWorkspace:{name:"resumeWorkspace",argsDecoder:re,resultDecoder:He},lockWorkspace:{name:"lockWorkspace",argsDecoder:dt,resultDecoder:He},lockWindow:{name:"lockWindow",argsDecoder:lt,resultDecoder:He},lockContainer:{name:"lockContainer",argsDecoder:yt,resultDecoder:He},pinWorkspace:{name:"pinWorkspace",argsDecoder:vt,resultDecoder:He},unpinWorkspace:{name:"unpinWorkspace",argsDecoder:re,resultDecoder:He},getWorkspaceIcon:{name:"getWorkspaceIcon",argsDecoder:re,resultDecoder:_e},setWorkspaceIcon:{name:"setWorkspaceIcon",argsDecoder:kt,resultDecoder:He}};class Ct{constructor(e,t){this.transport=e,this.registry=t,this.activeSubscriptions=[]}createCoreEventSubscription(){return e(this,void 0,void 0,(function*(){yield this.transport.coreSubscriptionReady(this.handleCoreEvent.bind(this))}))}handleCoreSubscription(e){const t=`${e.eventType}-${e.action}`,r=e.scope,i=e.scopeId;return this.registry.add(t,t=>{var o,n,s,a,d;const c={type:r,id:i},h={frame:(null===(o=t.frameSummary)||void 0===o?void 0:o.id)||(null===(n=t.windowSummary)||void 0===n?void 0:n.config.frameId),workspace:(null===(s=t.workspaceSummary)||void 0===s?void 0:s.id)||(null===(a=t.windowSummary)||void 0===a?void 0:a.config.workspaceId),window:null===(d=t.windowSummary)||void 0===d?void 0:d.config.windowId};this.checkScopeMatch(c,h)&&e.callback(t)})}send(t,r){return e(this,void 0,void 0,(function*(){const e=Object.values(St).find(e=>e.name===t);if(!e)throw new Error("Cannot find definition for operation name: "+t);if(e.argsDecoder)try{e.argsDecoder.runWithException(r)}catch(e){throw new Error(`Unexpected internal outgoing validation error: ${e.message}, for input: ${JSON.stringify(e.input)}, for operation ${t}`)}let i;try{const t=yield this.transport.transmitControl(e.name,r);i=e.resultDecoder.runWithException(t)}catch(e){if(e.kind)throw new Error(`Unexpected internal incoming validation error: ${e.message}, for input: ${JSON.stringify(e.input)}, for operation ${t}`);throw new Error(e.message)}return i}))}subscribe(t){return e(this,void 0,void 0,(function*(){let e=this.getActiveSubscription(t);const r=this.getRegistryKey(t);if(!e){const r=Dt[t.eventType],i=yield this.transport.subscribe(r.name,this.getBranchKey(t),t.eventType);i.onData(e=>{const t=e.data,r=pe.run(e.requestArguments),i=me.run(t.action);if(!r.ok||!i.ok)return;const o=r.result.type,n=r.result.branch,s=Dt[o].payloadDecoder.run(t.payload);if(!s.ok)return;const a=`${o}-${n}-${i.result}`;this.registry.execute(a,s.result)}),e={streamType:t.eventType,level:t.scope,levelId:t.scopeId,callbacksCount:0,gdSub:i},this.activeSubscriptions.push(e)}const i=this.registry.add(r,t.callback);return++e.callbacksCount,()=>{i(),--e.callbacksCount,0===e.callbacksCount&&(e.gdSub.close(),this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(e),1))}}))}checkScopeMatch(e,t){return"global"===e.type||("frame"===e.type&&e.id===t.frame||("workspace"===e.type&&e.id===t.workspace||"window"===e.type&&e.id===t.window))}handleCoreEvent(e){const t=e.data;try{const e=me.runWithException(t.action),r=ue.runWithException(t.type),i=Dt[r].payloadDecoder.runWithException(t.payload),o=`${r}-${e}`;this.registry.execute(o,i)}catch(e){console.warn(`Cannot handle event with data ${JSON.stringify(t)}, because of validation error: ${e.message}`)}}getBranchKey(e){return"global"===e.scope?e.scope:`${e.scope}_${e.scopeId}`}getRegistryKey(e){return`${e.eventType}-${this.getBranchKey(e)}-${e.action}`}getActiveSubscription(e){return this.activeSubscriptions.find(t=>t.streamType===e.eventType&&t.level===e.scope&&t.levelId===e.scopeId)}}class Et{constructor(e){this.agm=e,this.defaultTransportTimeout=3e4,this.coreEventMethodInitiated=!1}initiate(t){return e(this,void 0,void 0,(function*(){window.glue42gd?yield Promise.all(Object.values(xt).map(e=>this.verifyMethodLive(e.name))):(yield Promise.all([this.verifyMethodLive(bt),this.verifyMethodLive(It)]),yield this.transmitControl("frameHello",{windowId:t}))}))}coreSubscriptionReady(e){return this.coreEventMethodInitiated||this.subscribePlatform(e),this.corePlatformSubPromise}subscribePlatform(e){this.coreEventMethodInitiated=!0,this.corePlatformSubPromise=this.agm.subscribe(It),this.corePlatformSubPromise.then(t=>{t.onData(t=>e(t.data))})}subscribe(t,r,i){return e(this,void 0,void 0,(function*(){const e={branch:r,type:i};let o;try{o=yield this.agm.subscribe(t,{arguments:e})}catch(e){const i=`Internal subscription error! Error details: stream - ${t}, branch: ${r}. Internal message: ${e.message}`;throw new Error(i)}return o}))}transmitControl(t,r){return e(this,void 0,void 0,(function*(){const e=window.glue42gd?{operation:t,operationArguments:r}:{operation:t,domain:"workspaces",data:r},i=window.glue42gd?xt.control.name:bt;let o;const n=`Internal Workspaces Communication Error. Attempted operation: ${JSON.stringify(e)}. `;try{if(o=yield this.agm.invoke(i,e,"best",{methodResponseTimeoutMs:this.defaultTransportTimeout}),!o)throw new Error("Received unsupported result from GD - empty result");if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error("Received unsupported result from GD - empty values collection")}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${n} -> Inner message: ${t}`)}throw new Error(`${n} -> Inner message: ${e.message}`)}return o.all_return_values[0].returned}))}verifyMethodLive(e){return t=()=>new Promise(t=>{if(this.agm.methods().some(t=>t.name===e))return void t();let r=this.agm.methodAdded(i=>{i.name===e&&(r?(r(),r=null):setTimeout(()=>{r&&r()},0),t())})}),r=15e3,i="Timeout waiting for the Workspaces communication channels",new Promise((e,o)=>{let n=!0;const s=setTimeout(()=>{n&&(n=!1,o(i||"Promise timeout hit: "+r))},r);t().then(t=>{n&&(n=!1,clearTimeout(s),e(t))}).catch(e=>{n&&(n=!1,clearTimeout(s),o(e))})});var t,r,i}}const Bt=new WeakMap;class Mt{constructor(e,t){const r=t.wrapChildren(e.children);delete e.children,Bt.set(this,{base:t,children:r,definition:e})}get type(){return Bt.get(this).definition.type}addColumn(e){return Bt.get(this).base.add("column",Bt.get(this).children,e)}addRow(e){return Bt.get(this).base.add("row",Bt.get(this).children,e)}addGroup(e){return Bt.get(this).base.add("group",Bt.get(this).children,e)}addWindow(e){return Bt.get(this).base.addWindow(Bt.get(this).children,e),this}serialize(){const e=Bt.get(this).definition;return e.children=Bt.get(this).base.serializeChildren(Bt.get(this).children),e}}class Pt{constructor(e){this.getBuilder=e}wrapChildren(e){return e.map(e=>"window"===e.type?e:this.getBuilder({type:e.type,definition:e}))}add(e,t,r){const i=U.runWithException(r),o=this.getBuilder({type:e,definition:i});return t.push(o),o}addWindow(e,t){const r=N.runWithException(t);r.type="window",e.push(r)}serializeChildren(e){return e.map(e=>e instanceof Mt?e.serialize():e)}}const At=new WeakMap;class Ft{constructor(e,t,r){const i=t.wrapChildren(e.children);delete e.children,At.set(this,{base:t,children:i,definition:e,controller:r})}addColumn(e){const t=At.get(this).children;if(!t.every(e=>e instanceof Mt&&"column"===e.type))throw new Error("Cannot add a column to this workspace, because there are already children of another type");return At.get(this).base.add("column",t,e)}addRow(e){const t=At.get(this).children;if(!t.every(e=>e instanceof Mt&&"row"===e.type))throw new Error("Cannot add a row to this workspace, because there are already children of another type");return At.get(this).base.add("row",t,e)}addGroup(e){const t=At.get(this).children;if(0!==t.length)throw new Error("Cannot add a group to this workspace, because there are already defined children.");return At.get(this).base.add("group",t,e)}addWindow(e){const t=At.get(this).children;if(0!==t.length)throw new Error("Cannot add a window to this workspace, because there are already defined children.");return At.get(this).base.addWindow(t,e),this}getChildAt(e){P.runWithException(e);return At.get(this).children[e]}create(t){return e(this,void 0,void 0,(function*(){const e=H.runWithException(t),r=At.get(this).definition;r.children=At.get(this).base.serializeChildren(At.get(this).children);return At.get(this).controller.createWorkspace(r,e)}))}}const Tt=new WeakMap,Rt=e=>Tt.get(e).base;class Lt{constructor(e){Tt.set(this,{base:e})}get type(){return"row"}get id(){return Rt(this).getId(this)}get frameId(){return Rt(this).getFrameId(this)}get workspaceId(){return Rt(this).getWorkspaceId(this)}get positionIndex(){return Rt(this).getPositionIndex(this)}get children(){return Rt(this).getAllChildren(this)}get parent(){return Rt(this).getMyParent(this)}get frame(){return Rt(this).getMyFrame(this)}get workspace(){return Rt(this).getMyWorkspace(this)}get allowDrop(){return Rt(this).getAllowDrop(this)}get allowSplitters(){return Rt(this).getAllowSplitters(this)}get minWidth(){return Rt(this).getMinWidth(this)}get minHeight(){return Rt(this).getMinHeight(this)}get maxWidth(){return Rt(this).getMaxWidth(this)}get maxHeight(){return Rt(this).getMaxHeight(this)}get width(){return Rt(this).getWidthInPx(this)}get height(){return Rt(this).getHeightInPx(this)}get isPinned(){return Rt(this).getIsPinned(this)}get isMaximized(){return Rt(this).getIsMaximized(this)}addWindow(e){return Rt(this).addWindow(this,e,"row")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Rt(this).addParent(this,"group","row",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"column"!==t.type)throw new Error("Expected a column definition, but received "+t.type);return Rt(this).addParent(this,"column","row",t)}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as row children is not supported")}))}removeChild(e){return Rt(this).removeChild(this,e)}maximize(){return Rt(this).maximize(this)}restore(){return Rt(this).restore(this)}close(){return Rt(this).close(this)}lock(e){let t=void 0;if("function"==typeof e){t=e({allowDrop:this.allowDrop,allowSplitters:this.allowSplitters})}else t=e;const r=void 0===t?void 0:ut.runWithException(t);return Rt(this).lockContainer(this,r)}setHeight(t){return e(this,void 0,void 0,(function*(){return P.runWithException(t),Rt(this).setHeight(this,t)}))}}const zt=new WeakMap,Ht=e=>zt.get(e).base;class Ot{constructor(e){zt.set(this,{base:e})}get type(){return"column"}get id(){return Ht(this).getId(this)}get frameId(){return Ht(this).getFrameId(this)}get workspaceId(){return Ht(this).getWorkspaceId(this)}get positionIndex(){return Ht(this).getPositionIndex(this)}get children(){return Ht(this).getAllChildren(this)}get parent(){return Ht(this).getMyParent(this)}get frame(){return Ht(this).getMyFrame(this)}get workspace(){return Ht(this).getMyWorkspace(this)}get allowDrop(){return Ht(this).getAllowDrop(this)}get allowSplitters(){return Ht(this).getAllowSplitters(this)}get minWidth(){return Ht(this).getMinWidth(this)}get minHeight(){return Ht(this).getMinHeight(this)}get maxWidth(){return Ht(this).getMaxWidth(this)}get maxHeight(){return Ht(this).getMaxHeight(this)}get width(){return Ht(this).getWidthInPx(this)}get height(){return Ht(this).getHeightInPx(this)}get isPinned(){return Ht(this).getIsPinned(this)}get isMaximized(){return Ht(this).getIsMaximized(this)}addWindow(e){return Ht(this).addWindow(this,e,"column")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Ht(this).addParent(this,"group","column",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as column children is not supported")}))}addRow(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"row"!==t.type)throw new Error("Expected a row definition, but received "+t.type);return Ht(this).addParent(this,"row","column",t)}))}removeChild(e){return Ht(this).removeChild(this,e)}maximize(){return Ht(this).maximize(this)}restore(){return Ht(this).restore(this)}close(){return Ht(this).close(this)}lock(e){let t=void 0;if("function"==typeof e){t=e({allowDrop:this.allowDrop,allowSplitters:this.allowSplitters})}else t=e;const r=void 0===t?void 0:pt.runWithException(t);return Ht(this).lockContainer(this,r)}setWidth(t){return e(this,void 0,void 0,(function*(){return P.runWithException(t),Ht(this).setWidth(this,t)}))}}const jt=new WeakMap,_t=e=>jt.get(e).base;class $t{constructor(e){jt.set(this,{base:e})}get type(){return"group"}get id(){return _t(this).getId(this)}get frameId(){return _t(this).getFrameId(this)}get workspaceId(){return _t(this).getWorkspaceId(this)}get positionIndex(){return _t(this).getPositionIndex(this)}get children(){return _t(this).getAllChildren(this)}get parent(){return _t(this).getMyParent(this)}get frame(){return _t(this).getMyFrame(this)}get workspace(){return _t(this).getMyWorkspace(this)}get allowExtract(){return _t(this).getAllowExtract(this)}get allowDropLeft(){return _t(this).getAllowDropLeft(this)}get allowDropRight(){return _t(this).getAllowDropRight(this)}get allowDropTop(){return _t(this).getAllowDropTop(this)}get allowDropBottom(){return _t(this).getAllowDropBottom(this)}get allowDropHeader(){return _t(this).getAllowDropHeader(this)}get allowDrop(){return _t(this).getAllowDrop(this)}get showMaximizeButton(){return _t(this).getShowMaximizeButton(this)}get showEjectButton(){return _t(this).getShowEjectButton(this)}get showAddWindowButton(){return _t(this).getShowAddWindowButton(this)}get minWidth(){return _t(this).getMinWidth(this)}get minHeight(){return _t(this).getMinHeight(this)}get maxWidth(){return _t(this).getMaxWidth(this)}get maxHeight(){return _t(this).getMaxHeight(this)}get width(){return _t(this).getWidthInPx(this)}get height(){return _t(this).getHeightInPx(this)}get isMaximized(){return _t(this).getIsMaximized(this)}addWindow(e){return _t(this).addWindow(this,e,"group")}addGroup(){return e(this,void 0,void 0,(function*(){throw new Error("Adding groups as group child is not supported")}))}addColumn(){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as group child is not supported")}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as group child is not supported")}))}removeChild(e){return _t(this).removeChild(this,e)}maximize(){return _t(this).maximize(this)}restore(){return _t(this).restore(this)}close(){return _t(this).close(this)}lock(e){let t=void 0;if("function"==typeof e){t=e({allowDrop:this.allowDrop,allowDropHeader:this.allowDropHeader,allowDropLeft:this.allowDropLeft,allowDropRight:this.allowDropRight,allowDropTop:this.allowDropTop,allowDropBottom:this.allowDropBottom,allowExtract:this.allowExtract,showAddWindowButton:this.showAddWindowButton,showEjectButton:this.showEjectButton,showMaximizeButton:this.showMaximizeButton})}else t=e;const r=void 0===t?void 0:mt.runWithException(t);return _t(this).lockContainer(this,r)}setSize(t){return e(this,void 0,void 0,(function*(){const e=ht.runWithException(t);if(!e.width&&!e.height)throw new Error("Expected either width or height to be passed.");return _t(this).setSize(this,t.width,t.height)}))}}const Gt=new WeakMap,Nt=e=>Gt.get(e).manager.getWorkspaceData(e),Jt=e=>Gt.get(e).manager;class Ut{constructor(e){Gt.set(this,{manager:e})}get id(){return Nt(this).id}get frameId(){return Nt(this).config.frameId}get positionIndex(){return Nt(this).config.positionIndex}get title(){return Nt(this).config.title}get layoutName(){return Nt(this).config.layoutName}get isHibernated(){return Nt(this).config.isHibernated}get isSelected(){return Nt(this).config.isSelected}get children(){return Nt(this).children}get frame(){return Nt(this).frame}get allowSplitters(){return Nt(this).config.allowSplitters}get allowDrop(){return Nt(this).config.allowDrop}get allowDropLeft(){return Nt(this).config.allowDropLeft}get allowDropTop(){return Nt(this).config.allowDropTop}get allowDropRight(){return Nt(this).config.allowDropRight}get allowDropBottom(){return Nt(this).config.allowDropBottom}get allowExtract(){return Nt(this).config.allowExtract}get showCloseButton(){return Nt(this).config.showCloseButton}get showSaveButton(){return Nt(this).config.showSaveButton}get minWidth(){return Nt(this).config.minWidth}get minHeight(){return Nt(this).config.minHeight}get maxWidth(){return Nt(this).config.maxWidth}get maxHeight(){return Nt(this).config.maxHeight}get width(){return Nt(this).config.widthInPx}get height(){return Nt(this).config.heightInPx}get showWindowCloseButtons(){return Nt(this).config.showWindowCloseButtons}get showEjectButtons(){return Nt(this).config.showEjectButtons}get showAddWindowButtons(){return Nt(this).config.showAddWindowButtons}get isPinned(){return Nt(this).config.isPinned}removeChild(t){return e(this,void 0,void 0,(function*(){z(t);const e=this.children.find(t);e&&(yield e.close(),yield this.refreshReference())}))}remove(t){return e(this,void 0,void 0,(function*(){z(t);const e=Nt(this).controller.iterateFindChild(this.children,t);yield e.close(),yield this.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){yield Nt(this).controller.focusItem(this.id),yield this.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=Nt(this).controller,t=yield Nt(this).frame.workspaces();if(1===t.length&&t.every(e=>e.id===this.id))return this.frame.close();yield e.closeItem(this.id)}))}snapshot(){return Nt(this).controller.getSnapshot(this.id,"workspace")}saveLayout(t,r){return e(this,void 0,void 0,(function*(){M.runWithException(t),yield Nt(this).controller.saveLayout({name:t,workspaceId:this.id,saveContext:null==r?void 0:r.saveContext,metadata:null==r?void 0:r.metadata})}))}setTitle(t){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=Nt(this).controller;yield e.setItemTitle(this.id,t),yield this.refreshReference()}))}getContext(){return Nt(this).controller.getWorkspaceContext(this.id)}setContext(e){return Nt(this).controller.setWorkspaceContext(this.id,e)}updateContext(e){return Nt(this).controller.updateWorkspaceContext(this.id,e)}onContextUpdated(e){return Nt(this).controller.subscribeWorkspaceContextUpdated(this.id,e)}refreshReference(){return e(this,void 0,void 0,(function*(){const e=yield Nt(this).controller.getSnapshot(this.id,"workspace"),t=Nt(this).controller.flatChildren(Nt(this).children),r=Nt(this).controller.refreshChildren({existingChildren:t,workspace:this,parent:this,children:e.children}),i=this.frame;let o;if(i.id===e.config.frameId)Jt(this).remapFrame(i,e.frameSummary),o=i;else{const t={summary:e.frameSummary};o=Nt(this).ioc.getModel("frame",t)}Jt(this).remapWorkspace(this,{config:e.config,children:r,frame:o})}))}getIcon(){return e(this,void 0,void 0,(function*(){return Nt(this).controller.getWorkspaceIcon(this.id)}))}setIcon(t){return e(this,void 0,void 0,(function*(){return Nt(this).controller.setWorkspaceIcon(this.id,t)}))}getBox(e){z(e);const t=Nt(this).children;return Nt(this).controller.iterateFindChild(t,t=>"window"!==t.type&&e(t))}getAllBoxes(e){z(e,!0);const t=Nt(this).children,r=Nt(this).controller.iterateFilterChildren(t,e=>"window"!==e.type);return e?r.filter(e):r}getRow(e){return z(e),this.getBox(t=>"row"===t.type&&e(t))}getAllRows(e){return z(e,!0),e?this.getAllBoxes(t=>"row"===t.type&&e(t)):this.getAllBoxes(e=>"row"===e.type)}getColumn(e){return z(e),this.getBox(t=>"column"===t.type&&e(t))}getAllColumns(e){return z(e,!0),e?this.getAllBoxes(t=>"column"===t.type&&e(t)):this.getAllBoxes(e=>"column"===e.type)}getGroup(e){return z(e),this.getBox(t=>"group"===t.type&&e(t))}getAllGroups(e){return z(e,!0),e?this.getAllBoxes(t=>"group"===t.type&&e(t)):this.getAllBoxes(e=>"group"===e.type)}getWindow(e){z(e);const t=Nt(this).children;return Nt(this).controller.iterateFindChild(t,t=>"window"===t.type&&e(t))}getAllWindows(e){z(e,!0);const t=Nt(this).children,r=Nt(this).controller.iterateFilterChildren(t,e=>"window"===e.type);return e?r.filter(e):r}addRow(e){return Nt(this).base.addParent(this,"row","workspace",e)}addColumn(e){return Nt(this).base.addParent(this,"column","workspace",e)}addGroup(e){return Nt(this).base.addParent(this,"group","workspace",e)}addWindow(e){return Nt(this).base.addWindow(this,e,"workspace")}bundleToRow(){return e(this,void 0,void 0,(function*(){yield Nt(this).controller.bundleTo("row",this.id),yield this.refreshReference()}))}bundleToColumn(){return e(this,void 0,void 0,(function*(){yield Nt(this).controller.bundleTo("column",this.id),yield this.refreshReference()}))}hibernate(){return e(this,void 0,void 0,(function*(){yield Nt(this).controller.hibernateWorkspace(this.id),yield this.refreshReference()}))}resume(){return e(this,void 0,void 0,(function*(){yield Nt(this).controller.resumeWorkspace(this.id),yield this.refreshReference()}))}lock(t){return e(this,void 0,void 0,(function*(){let e=void 0;if("function"==typeof t){const r={allowDrop:this.allowDrop,allowDropLeft:this.allowDropLeft,allowDropTop:this.allowDropTop,allowDropRight:this.allowDropRight,allowDropBottom:this.allowDropBottom,allowExtract:this.allowExtract,allowSplitters:this.allowSplitters,showCloseButton:this.showCloseButton,showSaveButton:this.showSaveButton,showAddWindowButtons:this.showAddWindowButtons,showEjectButtons:this.showEjectButtons,showWindowCloseButtons:this.showWindowCloseButtons};e=t(r)}else e=t;const r=void 0===e?void 0:at.runWithException(e);yield Nt(this).controller.lockWorkspace(this.id,r),yield this.refreshReference()}))}pin(t){return e(this,void 0,void 0,(function*(){Wt.runWithException(t),yield Nt(this).controller.pinWorkspace(this.id,null==t?void 0:t.icon),yield this.refreshReference()}))}unpin(){return e(this,void 0,void 0,(function*(){yield Nt(this).controller.unpinWorkspace(this.id),yield this.refreshReference()}))}onClosed(t){return e(this,void 0,void 0,(function*(){z(t);const r=Nt(this).id,i={action:"closed",eventType:"workspace",scope:"workspace",scopeId:r,callback:()=>e(this,void 0,void 0,(function*(){t()}))};return yield Nt(this).controller.processLocalSubscription(i,r)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){z(t);const r=Nt(this).id,i={action:"added",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getBox(e=>e.id===r.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)}))};return yield Nt(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const r=Nt(this).id,i={action:"removed",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{windowId:e,workspaceId:i,frameId:o}=r.windowSummary.config;t({windowId:e,workspaceId:i,frameId:o})}))};return yield Nt(this).controller.processLocalSubscription(i,r)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){z(t);const r=Nt(this).id,i={action:"loaded",eventType:"window",scope:"workspace",scopeId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getWindow(e=>e.id&&e.id===r.windowSummary.config.windowId);t(e)}))};return yield Nt(this).controller.processLocalSubscription(i,r)}))}}const Kt=new WeakMap,qt=e=>Kt.get(e).manager.getWindowData(e);class Qt{constructor(e){Kt.set(this,{manager:e})}get id(){return qt(this).config.windowId}get elementId(){return qt(this).id}get type(){return"window"}get frameId(){return qt(this).frame.id}get workspaceId(){return qt(this).workspace.id}get positionIndex(){return qt(this).config.positionIndex}get isMaximized(){return qt(this).config.isMaximized}get isLoaded(){return qt(this).controller.checkIsWindowLoaded(this.id)}get focused(){return qt(this).config.isFocused}get title(){return qt(this).config.title}get allowExtract(){return qt(this).config.allowExtract}get showCloseButton(){return qt(this).config.showCloseButton}get width(){return qt(this).config.widthInPx}get height(){return qt(this).config.heightInPx}get minWidth(){return qt(this).config.minWidth}get minHeight(){return qt(this).config.minHeight}get maxWidth(){return qt(this).config.maxWidth}get maxHeight(){return qt(this).config.maxHeight}get workspace(){return qt(this).workspace}get frame(){return qt(this).frame}get parent(){return qt(this).parent}get appName(){return qt(this).config.appName}forceLoad(){return e(this,void 0,void 0,(function*(){if(this.isLoaded)return;const e=qt(this).controller,t=qt(this).id,r=yield e.forceLoadWindow(t);qt(this).config.windowId=r,yield this.workspace.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){const e=qt(this).id,t=qt(this).controller;yield t.focusItem(e),yield this.workspace.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=qt(this).id,t=qt(this).controller;yield t.closeItem(e),yield qt(this).parent.removeChild(t=>t.id===e),yield this.workspace.refreshReference()}))}setTitle(t){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=qt(this).id,r=qt(this).controller;yield r.setItemTitle(e,t),yield this.workspace.refreshReference()}))}maximize(){return e(this,void 0,void 0,(function*(){const e=qt(this).id,t=qt(this).controller;yield t.maximizeItem(e),yield this.workspace.refreshReference()}))}restore(){return e(this,void 0,void 0,(function*(){const e=qt(this).id,t=qt(this).controller;yield t.restoreItem(e),yield this.workspace.refreshReference()}))}eject(){return e(this,void 0,void 0,(function*(){if(!this.isLoaded)throw new Error("Cannot eject this window, because it is not loaded yet");const e=qt(this).id,t=yield qt(this).controller.ejectWindow(e);return qt(this).config.windowId=t,yield this.workspace.refreshReference(),this.getGdWindow()}))}getGdWindow(){if(!this.isLoaded)throw new Error("Cannot fetch this GD window, because the window is not yet loaded");const e=qt(this).config.windowId;return qt(this).controller.getGDWindow(e)}moveTo(t){return e(this,void 0,void 0,(function*(){if(!(t instanceof Lt||t instanceof Ot||t instanceof $t))throw new Error("Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group");const e=qt(this).id,r=qt(this).controller;if(!(yield r.getParent(e=>e.id===t.id)))throw new Error("Cannot move the window to the selected parent, because this parent does not exist.");yield r.moveWindowTo(e,t.id),yield this.workspace.refreshReference()}))}lock(t){return e(this,void 0,void 0,(function*(){let e=void 0;if("function"==typeof t){const r={allowExtract:this.allowExtract,showCloseButton:this.showCloseButton};e=t(r)}else e=t;const r=void 0===e?void 0:ct.runWithException(e),i=qt(this).id;yield qt(this).controller.lockWindow(i,r),yield this.workspace.refreshReference()}))}setSize(t){return e(this,void 0,void 0,(function*(){const e=ht.runWithException(t);if(!e.width&&!e.height)throw new Error("Expected either width or height to be passed.");const r=qt(this).id,i=qt(this).controller;yield i.resizeItem(r,{height:e.height,width:e.width,relative:!1}),yield this.workspace.refreshReference()}))}onRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const r=qt(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"removed",eventType:"window",scope:"window"};return yield qt(this).controller.processLocalSubscription(i,r)}))}}const Vt=new WeakMap,Xt=e=>Vt.get(e).manager.getFrameData(e);class Yt{constructor(e){Vt.set(this,{manager:e})}get id(){return Xt(this).summary.id}get isInitialized(){return Xt(this).summary.isInitialized}getBounds(){const e=Xt(this).summary.id;return Xt(this).controller.getFrameBounds(e)}resize(t){return e(this,void 0,void 0,(function*(){const e=$e.runWithException(t),r=Xt(this).summary.id;return Xt(this).controller.resizeItem(r,e)}))}move(t){return e(this,void 0,void 0,(function*(){const e=Ge.runWithException(t),r=Xt(this).summary.id;return Xt(this).controller.moveFrame(r,e)}))}focus(){const e=Xt(this).summary.id;return Xt(this).controller.focusItem(e)}state(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=Xt(this).summary.id;return Xt(this).controller.getFrameState(e)}))}minimize(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=Xt(this).summary.id;return Xt(this).controller.changeFrameState(e,"minimized")}))}maximize(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=Xt(this).summary.id;return Xt(this).controller.changeFrameState(e,"maximized")}))}restore(){return e(this,void 0,void 0,(function*(){if(!window.glue42gd)throw new Error("State operations are not supported in Glue42 Core");const e=Xt(this).summary.id;return Xt(this).controller.changeFrameState(e,"normal")}))}close(){const e=Xt(this).summary.id;return Xt(this).controller.closeItem(e)}snapshot(){const e=Xt(this).summary.id;return Xt(this).controller.getSnapshot(e,"frame")}workspaces(){return e(this,void 0,void 0,(function*(){return Xt(this).controller.getWorkspacesByFrameId(this.id)}))}getConstraints(){return e(this,void 0,void 0,(function*(){const e=Xt(this).controller,t=Xt(this).summary.id;return e.getFrameConstraints(t)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){M.runWithException(t);const e=Z.runWithException(r);return Xt(this).controller.restoreWorkspace(t,e)}))}createWorkspace(e,t){const r=te.runWithException(e),i=H.runWithException(t);return Xt(this).controller.createWorkspace(r,i)}init(t){return e(this,void 0,void 0,(function*(){if(ne.runWithException(t),Xt(this).summary.isInitialized)throw new Error("The frame has already been initialized");return Xt(this).controller.initFrame(this.id,t)}))}onClosed(t){return e(this,void 0,void 0,(function*(){z(t);const e=Xt(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id})},action:"closed",eventType:"frame",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(r,e)}))}onMaximized(t){return e(this,void 0,void 0,(function*(){z(t);const e=Xt(this).summary.id,r={callback:()=>{t()},action:"maximized",eventType:"frame",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(r,e)}))}onMinimized(t){return e(this,void 0,void 0,(function*(){z(t);const e=Xt(this).summary.id,r={callback:()=>{t()},action:"minimized",eventType:"frame",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(r,e)}))}onNormal(t){return e(this,void 0,void 0,(function*(){z(t);const e=Xt(this).summary.id,r={callback:()=>{t()},action:"normal",eventType:"frame",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(r,e)}))}onWorkspaceOpened(t){return e(this,void 0,void 0,(function*(){z(t);const r=Xt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield Xt(this).controller.transformStreamPayloadToWorkspace(r);t(e)})),action:"opened",eventType:"workspace",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(i,r)}))}onWorkspaceSelected(t){return e(this,void 0,void 0,(function*(){z(t);const r=Xt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield Xt(this).controller.getWorkspaceById(r.workspaceSummary.id);t(e)})),action:"selected",eventType:"workspace",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosed(t){return e(this,void 0,void 0,(function*(){z(t);const e=Xt(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},action:"closed",eventType:"workspace",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(r,e)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){z(t);const r=Xt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield Xt(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"added",eventType:"window",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){z(t);const e=Xt(this).summary.id,r={callback:e=>{const{windowId:r,workspaceId:i,frameId:o}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:o})},action:"removed",eventType:"window",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(r,e)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){z(t);const r=Xt(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield Xt(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"loaded",eventType:"window",scope:"frame"};return yield Xt(this).controller.processLocalSubscription(i,r)}))}onInitializationRequested(t){return e(this,void 0,void 0,(function*(){z(t),this.isInitialized||(yield t(Xt(this).summary.initializationContext))}))}}class Zt{constructor(){this.parentsData=new WeakMap,this.workspacesData=new WeakMap,this.windowsData=new WeakMap,this.framesData=new WeakMap,this.windowPlacementIdData={}}deleteData(e){if(e instanceof Qt){const t=Object.keys(this.windowPlacementIdData).find(t=>this.windowPlacementIdData[t]===e);t&&delete this.windowPlacementIdData[t],this.windowsData.delete(e)}e instanceof Ut&&this.workspacesData.delete(e),(e instanceof Lt||e instanceof Ot||e instanceof $t)&&this.parentsData.delete(e),e instanceof Yt&&this.framesData.delete(e)}setWindowData(e,t){this.windowPlacementIdData[t.id]=e,this.windowsData.set(e,t)}setWorkspaceData(e,t){this.workspacesData.set(e,t)}setParentData(e,t){this.parentsData.set(e,t)}setFrameData(e,t){this.framesData.set(e,t)}getWindowData(e){return this.windowsData.get(e)}getWindowByPlacementId(e){return this.windowPlacementIdData[e]}getWorkspaceData(e){return this.workspacesData.get(e)}getParentData(e){return this.parentsData.get(e)}getFrameData(e){return this.framesData.get(e)}remapChild(e,t){if(e instanceof Qt){const r=this.windowsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config}if(e instanceof Lt||e instanceof Ot||e instanceof $t){const r=this.parentsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config,r.children=t.children||r.children}}remapFrame(e,t){this.framesData.get(e).summary=t}remapWorkspace(e,t){const r=this.workspacesData.get(e);r.frame=t.frame||r.frame,r.config=t.config||r.config,r.children=t.children||r.children}}const er=new WeakMap,tr=(e,t)=>{const r=er.get(e).manager;return t instanceof Ut?r.getWorkspaceData(t):er.get(e).manager.getParentData(t)},rr=(e,t)=>er.get(e).manager.getWindowByPlacementId(t);class ir{constructor(e){er.set(this,{manager:e})}getId(e){return tr(this,e).id}getPositionIndex(e){return tr(this,e).config.positionIndex}getWorkspaceId(e){const t=tr(this,e);return t.config.workspaceId||t.workspace.id}getFrameId(e){return tr(this,e).frame.id}getAllChildren(e,t){z(t,!0);const r=tr(this,e).children;return void 0===t?r:r.filter(t)}getMyParent(e){if(!(e instanceof Ut))return tr(this,e).parent}getMyFrame(e){return tr(this,e).frame}getMyWorkspace(e){if(!(e instanceof Ut))return tr(this,e).workspace}addWindow(t,r,i){return e(this,void 0,void 0,(function*(){if(!r.appName&&!r.windowId)throw new Error("The window definition should contain either an appName or a windowId");const e=N.runWithException(r),o=tr(this,t).controller,n=yield o.add("window",tr(this,t).id,i,e);return t instanceof Ut?(yield t.refreshReference(),rr(this,n.itemId)):(yield this.getMyWorkspace(t).refreshReference(),rr(this,n.itemId))}))}addParent(t,r,i,o){return e(this,void 0,void 0,(function*(){const e=this.transformDefinition(r,o),n=tr(this,t).controller,s=(yield n.add("container",tr(this,t).id,i,e)).itemId;if(t instanceof Ut)return yield t.refreshReference(),t.getBox(e=>e.id===s);const a=this.getMyWorkspace(t);return yield a.refreshReference(),a.getBox(e=>e.id===s)}))}removeChild(t,r){return e(this,void 0,void 0,(function*(){z(r);const e=this.getAllChildren(t).find(r);e&&(yield e.close(),t instanceof Ut?yield t.refreshReference():yield this.getMyWorkspace(t).refreshReference())}))}maximize(t){return e(this,void 0,void 0,(function*(){const e=tr(this,t).controller;yield e.maximizeItem(tr(this,t).id),t.parent instanceof Ut?yield t.parent.refreshReference():yield this.getMyWorkspace(t.parent).refreshReference()}))}restore(t){return e(this,void 0,void 0,(function*(){const e=tr(this,t).controller;yield e.restoreItem(tr(this,t).id),t.parent instanceof Ut?yield t.parent.refreshReference():yield this.getMyWorkspace(t.parent).refreshReference()}))}close(t){return e(this,void 0,void 0,(function*(){const e=tr(this,t),r=tr(this,t).controller;yield r.closeItem(e.id),e.parent instanceof Ut?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}lockContainer(t,r){return e(this,void 0,void 0,(function*(){const e=tr(this,t),i=tr(this,t).controller;yield i.lockContainer(e.id,t.type,r),e.parent instanceof Ut?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}getAllowDrop(e){return tr(this,e).config.allowDrop}getAllowDropLeft(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Property allowDropLeft is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropLeft}getAllowDropRight(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Property allowDropRight is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropRight}getAllowDropTop(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Property allowDropTop is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropTop}getAllowDropBottom(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Property allowDropBottom is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropBottom}getAllowDropHeader(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Property allowDropHeader is available only for groups and not on ${e.type} ${e.id}`);return t.config.allowDropHeader}getAllowSplitters(e){const t=tr(this,e);if("group"===t.type)throw new Error("Cannot get allow splitters from private data "+t.type);return t.config.allowSplitters}getAllowExtract(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Cannot get allow extract from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.allowExtract}getShowMaximizeButton(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Cannot get show maximize button from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.showMaximizeButton}getShowEjectButton(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Cannot get show eject button from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.showEjectButton}getShowAddWindowButton(e){const t=tr(this,e);if("group"!==t.type)throw new Error(`Cannot get add window button from private data${t.type} with config ${"workspace"!==t.type?t.config.type:""}`);return t.config.showAddWindowButton}getMinWidth(e){return tr(this,e).config.minWidth}getMaxWidth(e){return tr(this,e).config.maxWidth}getMinHeight(e){return tr(this,e).config.minHeight}getMaxHeight(e){return tr(this,e).config.maxHeight}getWidthInPx(e){return tr(this,e).config.widthInPx}getHeightInPx(e){return tr(this,e).config.heightInPx}getIsPinned(e){return tr(this,e).config.isPinned}getIsMaximized(e){return tr(this,e).config.isMaximized}setHeight(t,r){return e(this,void 0,void 0,(function*(){const e=tr(this,t),{controller:i}=e;yield i.resizeItem(tr(this,t).id,{height:r}),e.parent instanceof Ut?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}setWidth(t,r){return e(this,void 0,void 0,(function*(){const e=tr(this,t),{controller:i}=e;yield i.resizeItem(tr(this,t).id,{width:r}),e.parent instanceof Ut?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}setSize(t,r,i){return e(this,void 0,void 0,(function*(){const e=tr(this,t),{controller:o}=e;yield o.resizeItem(tr(this,t).id,{width:r,height:i}),e.parent instanceof Ut?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}transformDefinition(e,t){let r;return void 0===t?r={type:e,children:[]}:t instanceof Mt?r=t.serialize():(void 0===t.type&&(t.type=e),r=V.runWithException(t),r.children=r.children||[]),r}}class or{constructor(e,t,r,i){this.ioc=e,this.windows=t,this.contexts=r,this.layouts=i}get bridge(){return this.ioc.bridge}get privateDataManager(){return this.ioc.privateDataManager}checkIsWindowLoaded(e){return e&&this.windows.list().some(t=>t.id===e)}createWorkspace(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(St.createWorkspace.name,t),r={summary:e.frameSummary},i={frame:this.ioc.getModel("frame",r),snapshot:e};return this.ioc.getModel("workspace",i)}))}createEmptyFrame(t){return e(this,void 0,void 0,(function*(){const e={summary:yield this.bridge.send(St.createFrame.name,t)};return this.ioc.getModel("frame",e)}))}initFrame(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.initFrame.name,Object.assign({frameId:t},r))}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(St.openWorkspace.name,{name:t,restoreOptions:r}),i={summary:yield this.bridge.send(St.getFrameSummary.name,{itemId:e.config.frameId})},o={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",o)}))}add(t,r,i,o){return e(this,void 0,void 0,(function*(){let e;const n={definition:o,parentId:r,parentType:i};if("window"===t)e=St.addWindow.name;else{if("container"!==t)throw new Error("Unrecognized add type: "+t);e=St.addContainer.name}return yield this.bridge.send(e,n)}))}getFrame(t){return e(this,void 0,void 0,(function*(){const e={summary:yield this.bridge.send(St.getFrameSummary.name,{itemId:t})};return this.ioc.getModel("frame",e)}))}getFrames(e,t){return e.reduce((e,r)=>{const i={summary:r},o=this.ioc.getModel("frame",i);return t&&!t(o)||e.push(o),e},[])}getAllWorkspaceSummaries(...e){return e.reduce((e,t)=>(e.push(...t.summaries),e),[]).map(e=>Object.assign({},{id:e.id,width:e.config.widthInPx,height:e.config.heightInPx},e.config))}handleOnSaved(e){const t=t=>{"Workspace"===t.type&&e(t)},r=this.layouts.onAdded(t),i=this.layouts.onChanged(t);return()=>{r(),i()}}handleOnRemoved(e){return this.layouts.onRemoved(t=>{"Workspace"===t.type&&e(t)})}transformStreamPayloadToWorkspace(t){return e(this,void 0,void 0,(function*(){const e={summary:t.frameSummary},r={frame:this.ioc.getModel("frame",e),snapshot:t.workspaceSnapshot||(yield this.bridge.send(St.getWorkspaceSnapshot.name,{itemId:t.workspaceSummary.id}))};return this.ioc.getModel("workspace",r)}))}fetchWorkspace(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(St.getWorkspaceSnapshot.name,{itemId:t}),r={summary:e.frameSummary},i={frame:this.ioc.getModel("frame",r),snapshot:e};return this.ioc.getModel("workspace",i)}))}bundleTo(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.bundleWorkspace.name,{type:t,workspaceId:r})}))}getWorkspaceContext(e){const t="___workspace___"+e;return this.contexts.get(t)}setWorkspaceContext(e,t){const r="___workspace___"+e;return this.contexts.set(r,t)}updateWorkspaceContext(e,t){const r="___workspace___"+e;return this.contexts.update(r,t)}subscribeWorkspaceContextUpdated(e,t){const r="___workspace___"+e;return this.contexts.subscribe(r,t)}restoreItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.restoreItem.name,{itemId:t})}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.maximizeItem.name,{itemId:t})}))}focusItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.focusItem.name,{itemId:t})}))}closeItem(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.closeItem.name,{itemId:t})}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.resizeItem.name,Object.assign({},{itemId:t},r))}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.moveFrame.name,Object.assign({},{itemId:t},r))}))}getGDWindow(e){return this.windows.list().find(t=>t.id===e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.forceLoadWindow.name,{itemId:t})).windowId}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(St.ejectWindow.name,{itemId:t})}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.moveWindowTo.name,{itemId:t,containerId:r})}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){let e;return"workspace"===r?e=yield this.bridge.send(St.getWorkspaceSnapshot.name,{itemId:t}):"frame"===r&&(e=yield this.bridge.send(St.getFrameSnapshot.name,{itemId:t})),e}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.setItemTitle.name,{itemId:t,title:r})}))}refreshChildren(e){const{parent:t,children:r,existingChildren:i,workspace:o}=e;if(t instanceof Qt||"window"===t.type)return;const n=r.map(e=>{let r=i.find(t=>"window"===t.type?t.elementId===e.id:t.id===e.id);if(r)this.privateDataManager.remapChild(r,{parent:t,children:[],config:e.config});else{let i;i="window"===e.type?{id:e.id,parent:t,frame:o.frame,workspace:o,config:e.config}:{id:e.id,parent:t,frame:o.frame,workspace:o,config:e.config,children:[]},r=this.ioc.getModel(e.type,i)}return"window"!==e.type&&this.refreshChildren({workspace:o,existingChildren:i,children:e.children,parent:r}),r});return t instanceof Ut||this.privateDataManager.remapChild(t,{children:n}),n}iterateFindChild(e,t){let r=e.find(e=>t(e));return r||(e.some(e=>!(e instanceof Qt)&&(r=this.iterateFindChild(e.children,t),!!r||void 0)),r)}iterateFilterChildren(e,t){const r=e.filter(e=>t(e)),i=e.reduce((e,r)=>(r instanceof Qt||e.push(...this.iterateFilterChildren(r.children,t)),e),[]);return r.push(...i),r}notifyWindowAdded(e){return new Promise(t=>{if(this.windows.list().some(t=>t.id===e))return t();const r=this.windows.onWindowAdded(i=>{i.id===e&&(r&&r(),t())})})}hibernateWorkspace(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.hibernateWorkspace.name,{workspaceId:t})}))}resumeWorkspace(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.resumeWorkspace.name,{workspaceId:t})}))}lockWorkspace(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.lockWorkspace.name,{workspaceId:t,config:r})}))}lockWindow(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.lockWindow.name,{windowPlacementId:t,config:r})}))}lockContainer(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.lockContainer.name,{itemId:t,type:r,config:i})}))}pinWorkspace(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.pinWorkspace.name,{workspaceId:t,icon:r})}))}unpinWorkspace(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.unpinWorkspace.name,{workspaceId:t})}))}getWorkspaceIcon(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.getWorkspaceIcon.name,{workspaceId:t})).icon}))}setWorkspaceIcon(e,t){return this.bridge.send(St.setWorkspaceIcon.name,{workspaceId:e,icon:t})}}class nr{constructor(e,t){this.bridge=e,this.base=t}checkIsWindowLoaded(e){return this.base.checkIsWindowLoaded(e)}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.isWindowInWorkspace.name,{itemId:t})).inWorkspace}))}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r});return yield this.base.createWorkspace(e)}))}createEmptyFrame(t){return e(this,void 0,void 0,(function*(){return yield this.base.createEmptyFrame(t)}))}initFrame(t,r){return e(this,void 0,void 0,(function*(){return this.base.initFrame(t,r)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);if(null==r?void 0:r.frameId){if(!(yield this.bridge.send(St.getAllFramesSummaries.name)).summaries.some(e=>e.id===r.frameId))throw new Error(`Cannot reuse the frame with id: ${r.frameId}, because there is no frame with that ID found`)}return yield this.base.restoreWorkspace(t,r)}))}add(t,r,i,o){return e(this,void 0,void 0,(function*(){return yield this.base.add(t,r,i,o)}))}processLocalSubscription(e,t){return window.glue42gd?this.handleEnterpriseLocalSubscription(e,t):this.handleCoreLocalSubscription(e,t)}processGlobalSubscription(e,t,r){return window.glue42gd?this.handleEnterpriseGlobalSubscription(e,t,r):this.handleCoreGlobalSubscription(e,t,r)}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId)return yield this.base.getFrame(t.windowId);if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(St.getAllFramesSummaries.name);return this.base.getFrames(e.summaries,t)}))}getWorkspaceById(e){return this.base.fetchWorkspace(e)}transformStreamPayloadToWorkspace(e){return this.base.transformStreamPayloadToWorkspace(e)}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getWorkspacesByFrameId(t){return e(this,void 0,void 0,(function*(){const e=(yield this.getAllWorkspaceSummaries()).filter(e=>e.frameId===t);return yield Promise.all(e.map(e=>this.base.fetchWorkspace(e.id)))}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(St.getAllWorkspacesSummaries.name,{});return this.base.getAllWorkspaceSummaries(e)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const o=r.getWindow(t);o&&(e=o,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const o=r.getBox(t);o&&(e=o,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.getAllLayoutsSummaries.name)).summaries}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.deleteLayout.name,{name:t})}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.exportAllLayouts.name)).layouts.reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}saveLayout(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(St.saveLayout.name,t)}))}importLayout(t,r){return e(this,void 0,void 0,(function*(){yield Promise.all(t.map(e=>this.bridge.send(St.importLayout.name,{layout:e,mode:r})))}))}handleOnSaved(e){return this.base.handleOnSaved(e)}handleOnRemoved(e){return this.base.handleOnRemoved(e)}bundleTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.bundleTo(t,r)}))}getWorkspaceContext(e){return this.base.getWorkspaceContext(e)}setWorkspaceContext(e,t){return this.base.setWorkspaceContext(e,t)}updateWorkspaceContext(e,t){return this.base.updateWorkspaceContext(e,t)}subscribeWorkspaceContextUpdated(e,t){return this.base.subscribeWorkspaceContextUpdated(e,t)}restoreItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.restoreItem(t)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.maximizeItem(t)}))}focusItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.focusItem(t)}))}changeFrameState(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(St.changeFrameState.name,{frameId:t,requestedState:r})}))}getFrameBounds(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.getFrameBounds.name,{itemId:t})).bounds}))}getFrameState(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(St.getFrameState.name,{itemId:t})).state}))}closeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.closeItem(t)}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.resizeItem(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.base.forceLoadWindow(t);return yield this.base.notifyWindowAdded(e),e}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){const e=(yield this.base.ejectWindow(t)).windowId;return yield this.base.notifyWindowAdded(e),e}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveWindowTo(t,r)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.getSnapshot(t,r)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.setItemTitle(t,r)}))}flatChildren(e){return e.reduce((e,t)=>(e.push(t),"window"!==t.type&&e.push(...this.flatChildren(t.children)),e),[])}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}hibernateWorkspace(e){return this.base.hibernateWorkspace(e)}resumeWorkspace(e){return this.base.resumeWorkspace(e)}lockWorkspace(e,t){return this.base.lockWorkspace(e,t)}lockWindow(e,t){return this.base.lockWindow(e,t)}lockContainer(e,t,r){return this.base.lockContainer(e,t,r)}pinWorkspace(e,t){return this.base.pinWorkspace(e,t)}unpinWorkspace(e){return this.base.unpinWorkspace(e)}getWorkspaceIcon(e){return this.base.getWorkspaceIcon(e)}setWorkspaceIcon(e,t){return this.base.setWorkspaceIcon(e,t)}getFrameConstraints(t){return e(this,void 0,void 0,(function*(){const e=yield this.getSnapshot(t,"frame");return{minWidth:e.config.minWidth,maxWidth:e.config.maxWidth,minHeight:e.config.minHeight,maxHeight:e.config.maxHeight}}))}handleCoreLocalSubscription(t,r){return e(this,void 0,void 0,(function*(){if(yield this.bridge.createCoreEventSubscription(),t.scopeId=t.scopeId||r,"window"===t.eventType&&"loaded"===t.action){const r=t.callback,i=t=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(t.windowSummary.config.windowId),r(t)}));t.callback=i}return this.bridge.handleCoreSubscription(t)}))}handleEnterpriseLocalSubscription(t,r){if(t.scopeId=t.scopeId||r,"window"===t.eventType&&"loaded"===t.action){const r=t.callback,i=t=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(t.windowSummary.config.windowId),r(t)}));t.callback=i}return this.bridge.subscribe(t)}handleCoreGlobalSubscription(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.createCoreEventSubscription();const o={eventType:r,callback:t,action:i,scope:"global"};if("window"===r&&"loaded"===i){const r=r=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(r.windowSummary.config.windowId),t(r)}));o.callback=r}return this.bridge.handleCoreSubscription(o)}))}handleEnterpriseGlobalSubscription(t,r,i){const o={eventType:r,callback:t,action:i,scope:"global"};if("window"===r&&"loaded"===i){const r=r=>e(this,void 0,void 0,(function*(){yield this.base.notifyWindowAdded(r.windowSummary.config.windowId),t(r)}));o.callback=r}return this.bridge.subscribe(o)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const o of i){if(e)return;const i=yield this.base.fetchWorkspace(o.id);t(i,r)}}))}}class sr{constructor(e,t,r,i){this.agm=e,this.windows=t,this.layouts=r,this.contexts=i}get baseController(){return this._baseController||(this._baseController=new or(this,this.windows,this.contexts,this.layouts)),this._baseController}get controller(){return this._controllerInstance||(this._controllerInstance=new nr(this.bridge,this.baseController)),this._controllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new Ct(this.transport,r())),this._bridgeInstance}get transport(){return this._transportInstance||(this._transportInstance=new Et(this.agm)),this._transportInstance}get privateDataManager(){return this._privateDataManagerInstance||(this._privateDataManagerInstance=new Zt),this._privateDataManagerInstance}get parentBase(){return this._parentBaseInstance||(this._parentBaseInstance=new ir(this.privateDataManager)),this._parentBaseInstance}initiate(t){return e(this,void 0,void 0,(function*(){yield this.transport.initiate(t)}))}getModel(e,t){switch(e){case"frame":{const e=new Yt(this.privateDataManager),{summary:r}=t,i={summary:r,controller:this.controller};return this.privateDataManager.setFrameData(e,i),e}case"window":{const{id:e,parent:r,frame:i,workspace:o,config:n}=t,s={type:"window",controller:this.controller,config:n,id:e,parent:r,frame:i,workspace:o},a=new Qt(this.privateDataManager);return this.privateDataManager.setWindowData(a,s),a}case"row":case"column":case"group":{const{id:r,children:i,parent:o,frame:n,workspace:s,config:a}=t,d="column"===e?new Ot(this.parentBase):"row"===e?new Lt(this.parentBase):new $t(this.parentBase),c=this.buildChildren(i,n,s,d),h={id:r,parent:o,frame:n,workspace:s,config:a,type:e,controller:this.controller,children:c};return this.privateDataManager.setParentData(d,h),d}case"workspace":{const{snapshot:e,frame:r}=t,i=new Ut(this.privateDataManager),o=this.buildChildren(e.children,r,i,i),n={id:e.id,type:"workspace",config:e.config,base:this.parentBase,controller:this.controller,children:o,frame:r,ioc:this};return this.privateDataManager.setWorkspaceData(i,n),i}default:throw new Error("Unrecognized type: "+e)}}getBuilder(e){e.definition=e.definition||{},Array.isArray(e.definition.children)||(e.definition.children=[]);const t=new Pt(this.getBuilder.bind(this));switch(e.type){case"workspace":return new Ft(e.definition,t,this.controller);case"row":case"column":case"group":return e.definition.type=e.type,new Mt(e.definition,t);default:throw new Error("Unexpected Builder creation error, provided config: "+JSON.stringify(e))}}buildChildren(e,t,r,i){return e.map(e=>{switch(e.type){case"window":return this.getModel("window",{id:e.id,config:e.config,frame:t,workspace:r,parent:i});case"column":case"row":case"group":return this.getModel(e.type,{id:e.id,config:e.config,children:e.children,frame:t,workspace:r,parent:i});default:throw new Error("Unsupported child type: "+e.type)}})}}const ar=t=>e(void 0,void 0,void 0,(function*(){const r=new sr(t.agm,t.windows,t.layouts,t.contexts),i=t.interop.instance.windowId;yield r.initiate(i),t.workspaces=((t,r)=>{const i=r.controller,o=t=>e(void 0,void 0,void 0,(function*(){return z(t,!0),i.getFrames(t)})),n=t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},o=r.getModel("frame",i);t(o)},"frame","opened")}));return{inWorkspace:()=>{const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");return i.checkIsInSwimlane(e)},getBuilder:e=>{const t=ae.runWithException(e);return r.getBuilder(t)},getMyFrame:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your frame, because this window is not in a workspace");return i.getFrame({windowId:e})})),getFrame:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getFrame({predicate:t})})),getAllFrames:o,getAllWorkspacesSummaries:()=>i.getAllWorkspaceSummaries(),getMyWorkspace:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my workspace, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your workspace, because this window is not in a workspace");return(yield i.getWorkspaces(t=>!!t.getWindow(t=>t.id===e)))[0]})),getWorkspace:t=>e(void 0,void 0,void 0,(function*(){return z(t),(yield i.getWorkspaces(t))[0]})),getWorkspaceById:t=>e(void 0,void 0,void 0,(function*(){return M.runWithException(t),i.getWorkspaceById(t)})),getAllWorkspaces:e=>(z(e,!0),i.getWorkspaces(e)),getWindow:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getWindow(t)})),getBox:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.getParent(t)})),restoreWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){M.runWithException(t);const e=Z.runWithException(r);return i.restoreWorkspace(t,e)})),createWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){const e=te.runWithException(t),o=H.runWithException(r);return i.createWorkspace(e,o)})),createEmptyFrame:t=>e(void 0,void 0,void 0,(function*(){const e=oe.runWithException(t);return i.createEmptyFrame(null!=e?e:{})})),waitForFrame:t=>e(void 0,void 0,void 0,(function*(){return M.runWithException(t),new Promise((e,r)=>{let i=()=>{};n(r=>{r.id===t&&(e(r),i())}).then(e=>(i=e,o())).then(r=>{const o=r.find(e=>e.id===t);o&&(e(o),i())}).catch(r)})})),layouts:{getSummaries:()=>i.getLayoutSummaries(),delete:t=>e(void 0,void 0,void 0,(function*(){return M.runWithException(t),i.deleteLayout(t)})),export:t=>e(void 0,void 0,void 0,(function*(){return z(t,!0),i.exportLayout(t)})),import:(t,r="replace")=>e(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))throw new Error("The provided layouts argument is not an array: "+JSON.stringify(t));return t.forEach(e=>Ce.runWithException(e)),i.importLayout(t,r)})),save:t=>e(void 0,void 0,void 0,(function*(){const e=st.runWithException(t);return i.saveLayout(e)})),onSaved:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.handleOnSaved(t)})),onRemoved:t=>e(void 0,void 0,void 0,(function*(){return z(t),i.handleOnRemoved(t)}))},onFrameOpened:n,onFrameClosed:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id})},"frame","closed")})),onWorkspaceOpened:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(r=>e(void 0,void 0,void 0,(function*(){const e=yield i.transformStreamPayloadToWorkspace(r);t(e)})),"workspace","opened")})),onWorkspaceClosed:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},"workspace","closed")})),onWindowAdded:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(o=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(o.windowSummary.config.workspaceId,"workspace"),n={summary:e.frameSummary},s={frame:r.getModel("frame",n),snapshot:e},a=r.getModel("workspace",s).getBox(e=>e.id===o.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===o.windowSummary.config.positionIndex);t(a)})),"window","added")})),onWindowLoaded:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(o=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(o.windowSummary.config.workspaceId,"workspace"),n={summary:e.frameSummary},s={frame:r.getModel("frame",n),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===o.windowSummary.config.windowId);t(a)})),"window","loaded")})),onWindowRemoved:t=>e(void 0,void 0,void 0,(function*(){return z(t),yield i.processGlobalSubscription(e=>{const{windowId:r,workspaceId:i,frameId:o}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:o})},"window","removed")}))}})(t,r)}));return"undefined"!=typeof window&&(window.GlueWorkspaces=ar),ar}));
//# sourceMappingURL=workspaces.umd.min.js.map
